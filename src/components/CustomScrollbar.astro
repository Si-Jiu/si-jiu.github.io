---
interface Props {
	children: any;
	orientation?: "horizontal" | "vertical";
	class?: string;
}

const {
	children,
	orientation = "horizontal",
	class: customClass = "",
} = Astro.props;
---

<div 
  class={`custom-scrollbar ${orientation === "horizontal" ? "horizontal-scrollbar" : "vertical-scrollbar"} ${customClass}`}
  data-orientation={orientation}
>
  {children}
</div>

<style>
  .custom-scrollbar {
    overflow: auto;
    position: relative;
  }

  .horizontal-scrollbar {
    overflow-x: auto;
    overflow-y: hidden;
  }

  .vertical-scrollbar {
    overflow-y: auto;
    overflow-x: hidden;
  }

  /* 隐藏默认滚动条 */
  .custom-scrollbar::-webkit-scrollbar {
    display: none;
  }

  .custom-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  /* 自定义滚动条轨道 */
  .custom-scrollbar::after {
    content: "";
    position: absolute;
    background: #e5e7eb; /* 浅灰色轨道 */
    border-radius: 4px;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
  }

  .horizontal-scrollbar::after {
    bottom: 2px;
    left: 0;
    right: 0;
    height: 6px;
  }

  .vertical-scrollbar::after {
    right: 2px;
    top: 0;
    bottom: 0;
    width: 6px;
  }

  /* 自定义滚动条拇指 */
  .custom-scrollbar::before {
    content: "";
    position: absolute;
    background: #6366f1; /* indigo-500 主题色 */
    border-radius: 4px;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
  }

  .horizontal-scrollbar::before {
    bottom: 2px;
    height: 6px;
    min-width: 20px;
  }

  .vertical-scrollbar::before {
    right: 2px;
    width: 6px;
    min-height: 20px;
  }

  /* 悬停时显示滚动条 */
  .custom-scrollbar:hover::after,
  .custom-scrollbar:hover::before {
    opacity: 1;
  }

  /* 夜间模式样式 */
  .dark .custom-scrollbar::after {
    background: #374151; /* 夜间模式轨道色 */
  }

  .dark .custom-scrollbar::before {
    background: #6366f1; /* indigo-500 夜间模式拇指 */
  }

  /* 滚动时显示滚动条 */
  .custom-scrollbar:active::after,
  .custom-scrollbar:active::before,
  .custom-scrollbar:focus::after,
  .custom-scrollbar:focus::before {
    opacity: 1;
  }
</style>

<script>
  // 获取组件元素
  const scrollbarEl = document.currentScript?.parentElement?.querySelector('.custom-scrollbar');
  
  if (scrollbarEl) {
    // 创建滚动条轨道和拇指元素
    const track = document.createElement('div');
    const thumb = document.createElement('div');
    
    // 设置轨道样式
    track.className = 'custom-track';
    track.style.position = 'absolute';
    track.style.background = '#e5e7eb'; // 浅灰色轨道
    track.style.borderRadius = '4px';
    track.style.opacity = '0';
    track.style.transition = 'opacity 0.3s';
    track.style.pointerEvents = 'none';
    track.style.zIndex = '10';
    
    // 设置拇指样式
    thumb.className = 'custom-thumb';
    thumb.style.position = 'absolute';
    thumb.style.background = '#6366f1'; // indigo-500 主题色
    thumb.style.borderRadius = '4px';
    thumb.style.opacity = '0';
    thumb.style.transition = 'opacity 0.3s';
    thumb.style.pointerEvents = 'none';
    thumb.style.zIndex = '10';
    
    // 根据方向设置轨道和拇指的位置和尺寸
    if (scrollbarEl.dataset.orientation === 'horizontal') {
      track.style.bottom = '2px';
      track.style.left = '0';
      track.style.right = '0';
      track.style.height = '6px';
      
      thumb.style.bottom = '2px';
      thumb.style.height = '6px';
      thumb.style.minWidth = '20px';
    } else {
      track.style.right = '2px';
      track.style.top = '0';
      track.style.bottom = '0';
      track.style.width = '6px';
      
      thumb.style.right = '2px';
      thumb.style.width = '6px';
      thumb.style.minHeight = '20px';
    }
    
    // 添加轨道和拇指到滚动条容器
    scrollbarEl.appendChild(track);
    scrollbarEl.appendChild(thumb);
    
    // 更新滚动条位置和尺寸的函数
    function updateScrollbar() {
      if (scrollbarEl.dataset.orientation === 'horizontal') {
        const scrollWidth = scrollbarEl.scrollWidth;
        const clientWidth = scrollbarEl.clientWidth;
        const scrollLeft = scrollbarEl.scrollLeft;
        
        if (scrollWidth > clientWidth) {
          const thumbWidth = Math.max(20, (clientWidth / scrollWidth) * clientWidth);
          const thumbLeft = (scrollLeft / (scrollWidth - clientWidth)) * (clientWidth - thumbWidth);
          
          thumb.style.width = `${thumbWidth}px`;
          thumb.style.left = `${thumbLeft}px`;
        }
      } else {
        const scrollHeight = scrollbarEl.scrollHeight;
        const clientHeight = scrollbarEl.clientHeight;
        const scrollTop = scrollbarEl.scrollTop;
        
        if (scrollHeight > clientHeight) {
          const thumbHeight = Math.max(20, (clientHeight / scrollHeight) * clientHeight);
          const thumbTop = (scrollTop / (scrollHeight - clientHeight)) * (clientHeight - thumbHeight);
          
          thumb.style.height = `${thumbHeight}px`;
          thumb.style.top = `${thumbTop}px`;
        }
      }
    }
    
    // 显示滚动条的函数
    function showScrollbar() {
      track.style.opacity = '1';
      thumb.style.opacity = '1';
    }
    
    // 隐藏滚动条的函数
    function hideScrollbar() {
      track.style.opacity = '0';
      thumb.style.opacity = '0';
    }
    
    // 夜间模式适配
    function updateTheme() {
      if (document.documentElement.classList.contains('dark')) {
        track.style.background = '#374151'; // 夜间模式轨道色
        thumb.style.background = '#6366f1'; // indigo-500 夜间模式拇指
      } else {
        track.style.background = '#e5e7eb'; // 浅灰色轨道
        thumb.style.background = '#6366f1'; // indigo-500 主题色
      }
    }
    
    // 初始化
    updateScrollbar();
    updateTheme();
    
    // 事件监听
    scrollbarEl.addEventListener('scroll', updateScrollbar);
    scrollbarEl.addEventListener('mouseenter', showScrollbar);
    scrollbarEl.addEventListener('mouseleave', hideScrollbar);
    scrollbarEl.addEventListener('mousedown', showScrollbar);
    window.addEventListener('mouseup', hideScrollbar);
    
    // 监听主题变化
    const observer = new MutationObserver(updateTheme);
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['class']
    });
    
    // 监听窗口大小变化
    window.addEventListener('resize', updateScrollbar);
  }
</script>